//! inveniemus 0.1.5

!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base"],b):"object"==typeof module&&module.exports?module.exports=b(require("creatartis-base")):a.inveniemus=b(a.base)}(this,function a(b){"use strict";function c(a,b,c){return Math.max(b,Math.min(c,a))}var d=b.declare,e=b.initialize,f=b.iterable,g=b.raiseIf,h=b.Events,i=b.Future,j=b.Iterable,k=b.Logger,l=b.Randomness,m=b.Statistics,n={__package__:"inveniemus",__name__:"inveniemus",__init__:a,__dependencies__:[b],__SERMAT__:{include:[]},metaheuristics:{},problems:{}},o=n.metaheuristics,p=n.problems,q=n.Element=d({constructor:function(a,b){this.values=a?this.checkValues(a,!1):this.randomValues(),this.evaluation=Array.isArray(b)?b:isNaN(b)?null:[+b]},model:j.repeat({n:Math.pow(2,32)},10).toArray(),randomValue:function(a){return 0|this.problem.random.randomInt(0,this.model[a].n)},randomValues:function(){var a=this.problem.random;return new Uint32Array(this.model.map(function(b){return a.randomInt(0,b.n)}))},checkValues:function(a,b){return new Uint32Array(this.model.map(function(c,d){var e=a[d],f=c.n;return isNaN(e)?(g(!b,"Value #",d," (",e,") is NaN!"),0):e<0||e>=f?(g(!b,"Value #",d," (",e,") is out of range [0,",f-1,"]!"),e<0?0:f-1):e}))},suffices:function(){return this.problem.sufficientElement(this)},emblem:function(){return this+""},evaluate:function(){var a=this;return i.then(this.problem.evaluation(this),function(b){return a.evaluation=Array.isArray(b)?b:isNaN(b)?null:[+b],g(null===a.evaluation,"The evaluation of element ",a," is null!"),a.evaluation})},hammingDistance:function(a,b){for(var c=0,d=0,e=Math.min(a.length,b.length);d<e;d++)a[d]!==b[d]&&c++;return c},manhattanDistance:function(a,b){for(var c=0,d=0,e=Math.min(a.length,b.length);d<e;d++)c+=Math.abs(a[d]-b[d]);return c},euclideanDistance:function(a,b){for(var c=0,d=0,e=Math.min(a.length,b.length);d<e;d++)c+=Math.pow(a[d]-b[d],2);return Math.sqrt(c)},rootMeanSquaredError:function(a,b){var c=0,d=f(b).map(function(b){return c++,Math.pow(b[0]-a.apply(this,b.slice(1)),2)}).sum();return 0===c?0:Math.sqrt(d/c)},isBetterThan:function(a){return this.problem.compare(this,a)>0},neighbourhood:function(a){var b,c,d=[],e=this.model,f=this.values,g=Math.abs(Array.isArray(a)?a[h]:a);isNaN(g)&&(g=1);for(var h=0,i=f.length;h<i;h++)c=f[h],b=e[h].n,c>0&&d.push(this.modification(h,Math.max(0,c-g))),c<b-1&&d.push(this.modification(h,Math.min(b-1,c+g)));return d},modification:function(){for(var a,b=this.values.slice(),d=0;d<arguments.length;d+=2)a=0|arguments[d],b[a]=c(b[a]+arguments[d+1],0,this.model[d].n-1);return new this.constructor(b)},mapping:function(){return this.problem.mapping(this)},rangeMapping:function(){var a=arguments,b=this.model,d=a[a.length-1];return g(a.length<1,"Element.rangeMapping() expects at least one argument!"),Array.prototype.map.call(this.values,function(e,f){var g=b[f].n,h=a.length>f?a[f]:d;return e=e/g*(h[1]-h[0])+h[0],c(e,h[0],h[1])})},normalizedValues:function(){return this.rangeMapping([0,1])},arrayMapping:function(){var a=arguments,b=a[a.length-1],c=this.model;return g(a.length<1,"Element.arrayMapping() expects at least one argument!"),Array.prototype.map.call(this.values,function(d,e){var f=a.length>e?a[e]:b,g=c[e].n,h=Math.floor(d/g*f.length);return f[h]})},setMapping:function(a,b){g(!Array.isArray(a),"Element.setMapping() expects an array argument!"),a=a.slice();var d=this.normalizedValues().map(function(b,d){g(a.length<1,"Element.setMapping(): insufficient elements!");var e=c(Math.floor(b*a.length),0,a.length-1);return a.splice(e,1)[0]});return b&&(g(1!=a.length,"Element.setMapping(): wrong amount of elements!"),d.push(a[0])),d},clone:function(){return new this.constructor(this.values,this.evaluation)},equals:function(a){if(this.constructor===a.constructor&&this.values.length===a.values.length){for(var b=0,c=this.values.length;b<c;b++)if(this.values[b]!==a.values[b])return!1;return!0}return!1},toString:function(){return Sermat.ser(this)},"static __SERMAT__":{identifier:"Element",serializer:function(a){return[a.problem,Array.prototype.slice.call(a.values),a.evaluation]},materializer:function(a,b){return b?new b[0].Element(b[1],arg[2]):null}}}),r=n.Problem=d({title:"Problem.title?",description:"Problem.description?",random:l.DEFAULT,objectives:[-(1/0)],constructor:function(a){a=a||{},e(this,a).string("title",{ignore:!0,coerce:!0}).string("description",{ignore:!0,coerce:!0}).object("random",{ignore:!0}).array("objectives",{ignore:!0}).array("elementModel",{ignore:!0}).func("Element",{ignore:!0}),isNaN(a.objective)||(this.objectives=[a.objective]),this.Element=d(this.Element||q,{problem:this}),a.elementModel&&(this.Element.prototype.model=a.elementModel)},evaluation:function(a){return f(a.values).sum()},evaluate:function(a,b){var c=!1;return a=f(a).filter(function(a){return b||null===a.evaluation},function(a){var b=a.evaluate();return c=c||i.__isFuture__(b),b}).toArray(),c?i.all(a):a},mapping:function(a){return a.normalizedValues()},sufficientElement:function(a){return!1},sufficientElements:function(a){return this.sufficientElement(a[0])},compare:function(a,b){return 1===this.objectives.length?this.singleObjectiveComparison(this.objectives[0],a.evaluation[0],b.evaluation[0]):this.paretoComparison(this.objectives,a.evaluation,b.evaluation)},singleObjectiveComparison:function(a,b,c){var d;switch(a){case-(1/0):return d=c-b,isNaN(d)?1/0:d;case+(1/0):return d=b-c,isNaN(d)?-(1/0):d;default:return d=Math.abs(c-a)-Math.abs(b-a),isNaN(d)?1/0:d}},paretoComparison:function(a,b,c){var d,e=0,f=0,h=this;return g(a.length!==b.length,"Expected ",a.length," evaluations, but got ",b.length,"!"),g(a.length!==c.length,"Expected ",a.length," evaluations, but got ",c.length,"!"),d=j.zip(a,b,c).mapApply(function(a,b,c){var d=h.singleObjectiveComparison(a,b,c);return d<0?e++:d>0&&f++,d}).toArray(),d.domination=0===e?f:0===f?-e:NaN,d},__params__:function(){var a={},b=this,c=["title","description"].concat(Array.prototype.slice.call(arguments));return c.forEach(function(c){b.hasOwnProperty(c)&&(a[c]=b[c])}),this.random!==l.DEFAULT&&(a.random=this.random),a},toString:function(){return Sermat.ser(this)},"static __SERMAT__":{identifier:"Problem",serializer:function(a){return[a.__params__()]}}}),s=n.Metaheuristic=d({logger:new k("inveniemus",k.ROOT,"INFO"),constructor:function(a){e(this,a).object("problem",{defaultValue:null}).number("size",{defaultValue:100,coerce:!0}).array("state",{defaultValue:[]}).number("steps",{defaultValue:100,coerce:!0}).integer("step",{defaultValue:-1,coerce:!0}).object("random",{defaultValue:l.DEFAULT}).object("statistics",{defaultValue:new m}).object("logger",{ignore:!0}),this.events=new h({events:["initiated","updated","expanded","evaluated","sieved","advanced","analyzed","finished"]})},__log__:function(a){this.logger&&this.logger[a].apply(this.logger,arguments)},initiate:function(a){a=isNaN(a)?this.size:+a>>0,this.state=new Array(a);for(var b=0;b<a;b++)this.state[b]=new this.problem.Element;this.onInitiate()},update:function(){var a=this;return this.expand(),i.then(this.evaluate(),function(){return a.sieve(),a.onUpdate(),a})},expand:function(a){a=a||this.expansion(),a.length<1?this.__log__("warn","Expansion is empty"):this.state=this.state.concat(a),this.onExpand()},expansion:function(a){var b=isNaN(this.expansionRate)?.5:+this.expansionRate;a=isNaN(a)?Math.floor(b*this.size):+a;var c,d=new Array(a);for(c=0;c<a;c++)d[c]=new this.problem.Element;return d},evaluate:function(a){var b=this,c=this.statistics&&this.statistics.stat({key:"evaluation_time"});return c&&c.startTime(),a=a||this.state,i.then(this.problem.evaluate(a),function(d){return a=b.sort(a),c&&c.addTime(),b.onEvaluate(d),a})},sort:function(a){return a=a||this.state,this.problem.objectives.length>1?a=this.multiObjectiveSort(a):(a.sort(this.problem.compare.bind(this.problem)),a.reverse()),a},sieve:function(a){a=isNaN(a)?this.size:Math.floor(a),this.state.length>a&&(this.state=this.state.slice(0,this.size)),this.onSieve()},finished:function(){return this.step>=this.steps||this.problem.sufficientElements(this.state)},analyze:function(a){a=a||this.statistics;var b=this.step;if(a){if(1===this.state[0].evaluation.length){var c=a.stat({key:"evaluation",step:b});this.state.forEach(function(a){c.add(a.evaluation[0],a)})}else{var d=this.state[0].evaluation.map(function(c,d){return a.stat({key:"evaluation",index:d,step:b})}),e=a.stat({key:"dominators",step:b}),f=a.stat({key:"dominated",step:b});this.state.forEach(function(a){a.evaluation.forEach(function(b,c){d[c].add(b,a)}),e.add(a.pareto.dominators.length,a),f.add(a.pareto.dominated.length,a)})}this.onAnalyze()}return a},advance:function(){var a,b=this,c=this.statistics&&this.statistics.stat({key:"step_time"});return isNaN(this.step)||+this.step<0?(this.reset(),c&&c.startTime(),this.initiate(),a=this.evaluate()):(c&&c.startTime(),a=this.update()),i.then(a,function(){return b.step=isNaN(b.step)||+b.step<0?0:+b.step+1,b.analyze(),c&&c.addTime(),b.onAdvance(),b})},run:function(){var a=this,b=this.advance.bind(this),c=function(){return!a.finished()};return i.doWhile(b,c).then(function(){return a.onFinish(),a.state[0]})},reset:function(){this.step=-1,this.statistics&&this.statistics.reset()},nub:function(a){return a=isNaN(a)?1e-15:+a,this.state=f(this.state).nub(function(b,c){var d=b.values,e=c.values,f=d.length;if(f!==c.values.length)return!1;for(var g=0;g<f;++g)if(Math.abs(d[g]-e[g])>a)return!1;return!0}).toArray(),this.state.length},onInitiate:function(){this.events.emit("initiated",this),this.__log__("debug","State has been initiated. Nos coepimus.")},onUpdate:function(){this.events.emit("updated",this),this.__log__("debug","State has been updated. Mutatis mutandis.")},onExpand:function(){this.events.emit("expanded",this),this.__log__("debug","State has been expanded. Nos exploramus.")},onEvaluate:function(a){this.events.emit("evaluated",this,a),this.__log__("debug","Evaluated and sorted ",a.length," elements. Appretiatus sunt.")},onSieve:function(){this.events.emit("sieved",this),this.__log__("debug","State has been sieved. Haec est viam.")},onAdvance:function(){this.events.emit("advanced",this),this.__log__("debug","Step ",this.step," has been completed. Nos proficimus.")},onAnalyze:function(){this.events.emit("analyzed",this),this.__log__("debug","Statistics have been gathered. Haec sunt numeri.")},onFinish:function(){this.events.emit("finished",this),this.__log__("debug","Finished. Nos invenerunt!")},paretoAnalysis:function(a){a=a||this.state;var b,c,d,e,f,g=a.length;for(b=0;b<g;b++)a[b].pareto={dominated:[],dominators:[]};for(b=0;b<g;b++)for(d=a[b],c=b+1;c<g;c++)e=a[c],f=this.problem.compare(d,e).domination,f>0?(d.pareto.dominated.push(e),e.pareto.dominators.push(d)):f<0&&(e.pareto.dominated.push(d),d.pareto.dominators.push(e));return a},multiObjectiveSort:function(a){return this.nonDominatedSort(a)},crowdingDistance:function(a){a=a||this.state;var b,c,d=a.slice(),e=this.problem.objectives.length;for(b=0;b<d.length;b++)d[b].crowdingDistance=0;for(b=0;b<e;b++)for(d.sort(function(a,c){return a.evaluation[b]-c.evaluation[b]}),d[0].crowdingDistance=1/0,d[d.length-1].crowdingDistance=1/0,c=1;c<d.length-1;c++)d[c].crowdingDistance+=d[c+1].evaluation[b]-d[c-1].evaluation[b];return a},nonDominatedSort:function(a){return a=this.paretoAnalysis(a),a=this.crowdingDistance(a),a.sort(function(a,b){return a.pareto.dominators.length-b.pareto.dominators.length||b.crowdingDistance-a.crowdingDistance}),a},strengthParetoSort:function(a){return a=this.paretoAnalysis(a),f(a).forEach(function(a){a.pareto.strength=f(a.pareto.dominators).map(function(a){return a.pareto.dominated.length}).sum()}),a.sort(function(a,b){return a.pareto.strength-b.pareto.strength})},toString:function(){return"[object "+(this.constructor.name||"Metaheuristic")+"]"},__params__:function(){var a={problem:this.problem,size:this.size,steps:this.steps};this.random!==l.DEFAULT&&(a.random=this.random),this.step>=0?(a.step=this.step,a.state=this.state,a.statistics=this.statistics):this.state.length>0&&(a.state=this.state);for(var b=0;b<arguments.length;b++){var c=arguments[b];this.hasOwnProperty(c)&&(a[c]=this[c])}return a},"static __SERMAT__":{identifier:"Metaheuristic",serializer:function(a){return[a.__params__()]}}}),t=(o.HillClimbing=d(s,{constructor:function(a){s.call(this,a),e(this,a).number("delta",{defaultValue:1,coerce:!0}).integer("size",{defaultValue:1,coerce:!0})},update:function(){var a=this,b=0;return i.all(this.state.map(function(c){var d=c.neighbourhood(a.delta);return d.push(c),i.then(a.evaluate(d),function(a){var d=a[0];return c===d&&b++,d})})).then(function(c){c=a.sort(c),a.state=c,a.__localOptima__=b,a.onUpdate()})},atLocalOptima:function(){return this.__localOptima__>=this.state.length},finished:function(){return s.prototype.finished.call(this)||this.atLocalOptima()},"static __SERMAT__":{identifier:"HillClimbing",serializer:function(a){return[a.__params__("delta")]}}}),o.GeneticAlgorithm=d(s,{constructor:function v(a){s.call(this,a),e(this,a).number("expansionRate",{defaultValue:.5,minimum:0,coerce:!0}).number("mutationRate",{defaultValue:.2,minimum:0,maximum:1,coerce:!0}).func("selection",{defaultValue:v.selections.rankSelection}).func("crossover",{defaultValue:v.crossovers.singlepointCrossover}).func("mutation",{defaultValue:v.mutations.singlepointUniformMutation})},expansion:function(){var a,b,c,d=[],e=Math.floor(this.expansionRate*this.size);e+=e%2;for(var f=0;f<e;f+=2){a=this.selection(),b=this.crossover(a);for(var g=0;g<b.length;g++)c=this.random.randomBool(this.mutationRate)?this.mutation(b[g]):b[g],d.push(c)}return this.onExpand(),d},"static selections":{rankSelection:function(a){a=isNaN(a)?2:+a;var b=this.state.length,c=this.random.randoms(a,0,b*(b+1)/2-1),d=[];return c.sort(function(a,b){return a-b}),this.state.forEach(function(e){for(var f=0;f<a;f++)c[f]+=f-b;c[0]<=0&&(d.push(e),c.shift())}),d.length<a&&(d=d.concat(this.state.slice(0,a-d.length))),d},rouletteSelection:function(a){a=isNaN(a)?2:0|a;var b=this.state.length,c=this.statistics.stat({key:"evaluation",step:this.step}),d=c.minimum(),e=c.sum(),f=this.random.randoms(a,0,e-b*d),g=[];return f.sort(function(a,b){return a-b}),this.state.forEach(function(c){for(var d=0;d<a;d++)f[d]+=d-b;f[0]<=0&&(g.push(c),f.shift())}),g.length<a&&(g=g.concat(this.state.slice(0,a-g.length))),g},stochasticUniversalSamplingSelection:function(a){a=isNaN(a)?2:0|a;var c=this.state,d=f(c).select("evaluation").sum(),e=d/a;return b.Iterable.iterate(function(a){return a+e},this.random.randomInt(e),a).map(function(a){for(var b=0,d=0;d<c.length;++d)if(b+=c[d].evaluation,b>=a)return c[d];return c[c.length-1]}).toArray()}},"static crossovers":{singlepointCrossover:function(a){g(!Array.isArray(a)||a.length<2,"A two parent array is required.");var b=this.random.randomInt(this.length-1)+1,c=Array.prototype.slice.call(a[0].values),d=Array.prototype.slice.call(a[1].values);return[new this.problem.Element(c.slice(0,b).concat(d.slice(b))),new this.problem.Element(d.slice(0,b).concat(c.slice(b)))]},twopointCrossover:function(a){g(!Array.isArray(a)||a.length<2,"A two parent array is required.");var b=this.random.randomInt(this.length-1)+1,c=this.random.randomInt(this.length-1)+1,d=Array.prototype.slice.call(a[0].values),e=Array.prototype.slice.call(a[1].values);return[new this.problem.Element(d.slice(0,b).concat(e.slice(b,c)).concat(d.slice(c))),new this.problem.Element(e.slice(0,b).concat(d.slice(b,c)).concat(e.slice(c)))]},uniformCrossover:function(a,b){b=isNaN(b)?a.length:0|b;for(var c,d=[],e=this.problem.elementLength(),f=this.random,g=0;g<b;++g){c=[];for(var h=0;h<e;++h)c.push(f.choice(a).values[h]);d.push(new this.problem.Element(c))}return d}},"static mutations":{singlepointUniformMutation:function(a){var b=this.random.randomInt(a.values.length);return a.modification(b,a.randomValue(b))},uniformMutation:function(a){max=isNaN(a)?1/0:+a;var b=this.problem.elementModel();return function(c){var d,e=a;c=new this.problem.Element(c.values);do d=this.random.randomInt(b.length),c.values[d]=this.random.random(b[d].min,b[d].max);while(this.random.randomBool(this.mutationRate)&&--e>0);return c}},singlepointBiasedMutation:function(a){var b=this.random,c=this.problem.elementModel(),d=b.randomInt(a.length);return a.modification(d,a.values[d]+(b.random()-b.random())*(c[d].max-c[d].min))},recombinationMutation:function(a){var b=a.values.slice(),c=this.random.randomInt(b.length),d=b[c],e=this.random.randomInt(b.length);return c===e&&(e=(e+1)%a.length),b[c]=b[e],b[e]=d,new this.problem.Element(b)}},"static __SERMAT__":{identifier:"GeneticAlgorithm",serializer:function(a){var b=a.__params__("expansionRate","mutationRate");return[b]}}}),o.BeamSearch=d(s,{constructor:function(a){s.call(this,a),e(this,a).number("delta",{ignore:!0,coerce:!0})},successors:function(a){return a.neighbourhood(this.delta)},expansion:function(){var a=[],b=this.successors.bind(this);return this.state.forEach(function(c){a=a.concat(b(c))}),this.onExpand(),a},"static __SERMAT__":{identifier:"BeamSearch",serializer:function(a){return[a.__params__("delta")]}}}),o.SimulatedAnnealing=d(s,{constructor:function(a){s.call(this,a),e(this,a).number("maximumTemperature",{defaultValue:1,coerce:!0}).number("minimumTemperature",{defaultValue:0,coerce:!0}).number("delta",{defaultValue:1,coerce:!0}).integer("size",{defaultValue:1,coerce:!0}).func("temperature",{defaultValue:this.coolingSchedule.linear})},randomNeighbour:function(a,b){b=isNaN(b)?this.delta:+b;var c=this.random.randomInt(a.values.length);return a.modification(c,this.random.randomBool()?+b:-b)},acceptance:function(a,b,d){if(d=isNaN(d)?this.temperature():+d,b.isBetterThan(a))return 1;var e=-Math.abs(b.evaluation-a.evaluation);return c(Math.exp(e/d),0,1)},coolingSchedule:{linear:function(){return(1-Math.max(0,this.step)/this.steps)*(this.maximumTemperature-this.minimumTemperature)+this.minimumTemperature}},update:function(){var a=this,b=this.temperature(),c=this.statistics.stat({key:"acceptance"}),d=this.statistics.stat({key:"temperature"});return d.add(b,this.step),i.all(this.state.map(function(d){var e=a.randomNeighbour(d);return i.then(e.evaluate(),function(){var f=a.acceptance(d,e,b);return c.add(f,e),a.random.randomBool(f)?e:d})})).then(function(b){return b=a.sort(b),a.state=b,a.onUpdate(),a})},"static __SERMAT__":{identifier:"SimulatedAnnealing",serializer:function(a){return[a.__params__("maximumTemperature","minimumTemperature","delta")]}}}),o.ParticleSwarm=d(s,{constructor:function(a){s.call(this,a),e(this,a).number("inertia",{defaultValue:1,coerce:!0}).number("localAcceleration",{defaultValue:.5,coerce:!0}).number("globalAcceleration",{defaultValue:.3,coerce:!0})},initiate:function(a){s.prototype.initiate.call(this,a);var b=this,c=this.state.forEach(function(a){var c=a.model;a.__velocity__=b.random.randoms(a.values.length,-1,1).map(function(a,b){return a*c[b].n}),a.__localBest__=a});return this.onInitiate(),c},nextVelocity:function(a,b){var c=this,d=a.__velocity__,e=a.__localBest__,f=this.random.random(this.localAcceleration),g=this.random.random(this.globalAcceleration),h=Array.prototype.map.call(a.values,function(a,h){return d[h]*c.inertia+f*(e.values[h]-a)+g*(b.values[h]-a)});return h},nextElement:function(a,b){var d=a.model,e=this.nextVelocity(a,b),f=Array.prototype.map.call(a.values,function(a,b){return c(a+e[b],0,d[b].n-1)}),g=new this.problem.Element(f);return i.then(g.evaluate(),function(){return g.__velocity__=e,g.__localBest__=g.isBetterThan(a.__localBest__)?g:a.__localBest__,g})},update:function(){var a=this,b=this.__globalBest__;return b||(b=this.__globalBest__=this.state[0]),i.all(this.state.map(function(c){return a.nextElement(c,b)})).then(function(b){return b=a.sort(b),a.state=b,a.problem.compare(a.__globalBest__,b[0])<0&&(a.__globalBest__=b[0]),a.onUpdate(),a})},"static __SERMAT__":{identifier:"ParticleSwarm",serializer:function(a){return[a.__params__("inertia","localAcceleration","globalAcceleration")]}}}),o.DifferentialEvolution=d(s,{constructor:function(a){s.call(this,a),e(this,a).number("differentialWeight",{coerce:!0,defaultValue:1,minimum:0,maximum:2}).number("crossoverProbability",{coerce:!0,defaultValue:.3,minimum:0,maximum:1}).integer("size",{coerce:!0,defaultValue:100,minimum:4})},expansion:function(){var a=this,b=this.state.map(function(b,d){var e=b.model,f=a.state.slice();f.splice(d,1);var g=a.random.choices(3,f),h=g[0].values,i=g[1].values,j=g[2].values,k=b.values.length,l=a.random.randomInt(k),m=b.values.map(function(b,d){return d===l||a.random.randomBool(a.crossoverProbability)?c(h[d]+a.differentialWeight*(i[d]-j[d],e[d].n-1)):b});return new a.problem.Element(m)});return this.onExpand(),b},"static __SERMAT__":{identifier:"DifferentialEvolution",serializer:function(a){return[a.__params__("differentialWeight","crossoverProbability")]}}}),o.EvolutionStrategy=d(s,{constructor:function(a){s.call(this,a),e(this,a).number("mutantCount",{coerce:!0,defaultValue:1,minimum:1}).integer("size",{coerce:!0,defaultValue:1,minimum:1})},mutant:function(a){var b=this.random,d=a.model,e=a.values.map(function(a,e){var f=d[e].n;return c(a+(b.random()-b.random())*f,0,f-1)});return new this.problem.Element(e)},mutants:function(a,b){b=isNaN(b)?this.mutantCount:+b;for(var c=[],d=0;d<b;++d)c.push(this.mutant(a));return c},expansion:function(){var a=this,b=[];return this.state.forEach(function(c){b=b.concat(a.mutants(c))}),this.onExpand(),b},"static __SERMAT__":{identifier:"DistributionEstimation",serializer:function(a){return[a.__params__("mutantCount")]}}}),o.HarmonySearch=d(s,{constructor:function(a){s.call(this,a),e(this,a).number("harmonyProbability",{coerce:!0,defaultValue:.9,minimum:0,maximum:1}).number("adjustProbability",{coerce:!0,defaultValue:.5,minimum:0,maximum:1}).number("delta",{coerce:!0,defaultValue:1}).number("fretWidth",{coerce:!0,defaultValue:.01})},expansion:function(){var a=this,b=this.random,c=this.problem.Element.prototype.model,d=c.map(function(c,d){if(b.randomBool(a.harmonyProbability)){var e=b.choice(a.state).values[d];return b.randomBool(a.adjustProbability)&&(e+=b.randomBool(.5)?-a.delta:a.delta),e}return 0|b.randomInt(0,c.n)});return this.onExpand(),[new this.problem.Element(d)]},"static __SERMAT__":{identifier:"HarmonySearch",serializer:function(a){return[a.__params__("harmonyProbability","adjustProbability","delta","fretWidth")]}}}),o.DistributionEstimation=d(s,{constructor:function(a){s.call(this,a),e(this,a).integer("histogramWidth",{coerce:!0,defaultValue:10,minimum:2})},expansion:function(a){var c=this,d=isNaN(this.expansionRate)?.5:+this.expansionRate,e=this.histograms();return a=isNaN(a)?Math.floor(d*this.size):0|a,b.Iterable.repeat(null,a).map(function(){return c.elementFromHistograms(e)}).toArray()},histograms:function(){return t.histograms(this.state,this.histogramWidth,this.problem.Element.prototype.model.length)},"static histograms":function(a,b,c){var d=a.length,e=j.iterate(function(a){return a.slice()},j.repeat(0,b).toArray(),c).toArray();return a.forEach(function(a){a.values.forEach(function(c,d){var f=Math.min(b-1,Math.floor(a.values[d]*b));e[d][f]++})}),e.map(function(a){return a.map(function(a){return a/d})})},elementFromHistograms:function(a){return t.elementFromHistograms(a,this.problem,this.random)},"static elementFromHistograms":function(a,b,c){for(var d,e,f=a.length,g=new Array(f),h=0;h<f;++h){d=a[h],e=c.random();for(var i=0;i<=d.length;++i)if(i===d.length||(e-=d[i])<=0){g[h]=Math.min(1,Math.max(0,(i+c.random())/d.length));break}}return new b.Element(g)},"static histogramProblem":function(a,c,e){c=isNaN(c)?30:Math.max(1,0|c),e=isNaN(e)?10:Math.max(2,0|e);var g=(a.elementLength(),this.elementFromHistograms);return HistogramProblem=d(r,{elementLength:function h(){return h*e},evaluation:function(d){var e=this.mapping(d),h=b.Iterable.repeat(null,c).map(function(){return g(e,a,a.random)});return i.all(f(h).map(function(a){return i.when(a.evaluate())})).then(function(a){return f(a).sum()/a.length})},mapping:function(a){for(var b,c,d=[],g=0;g<a.length;++g)b=a.values.slice(g*e,(g+1)*e),c=f(b).sum(),d[g]=b.map(function(a){return a/c});return d},compare:a.compare}),new HistogramProblem({random:a.random})},"static __SERMAT__":{identifier:"DistributionEstimation",serializer:function(a){return[a.__params__("histogramWidth")]}}}));o.GradientDescent=d(s,{constructor:function(a){s.call(this,a),e(this,a).number("delta",{coerce:!0,defaultValue:1}).integer("size",{coerce:!0,defaultValue:1,minimum:1})},gradient:function(a){return this.gradientFiniteDifferences(a)},rate:function(a){return a=isNaN(a)?this.step:0|a,1/Math.max(1,a)},estimatorWidth:function(a,b){return a=isNaN(a)?this.step:0|a,b=isNaN(b)?this.delta:+b,Math.pow(Math.max(1,a),-1/3)*b},update:function(){var a=this,b=this.rate(this.step);return i.all(this.state.map(function(d){var e=d.model;return i.then(a.gradient(d),function(f){var g=f.map(function(a,f){return c(d.values[f]-a*b,0,e[f].n-1)});return new a.problem.Element(g)})})).then(function(b){return a.evaluate(b)}).then(function(b){return a.state=b,a.onUpdate(),a})},gradientFiniteDifferences:function(a,b){b=isNaN(b)?this.estimatorWidth():+b;var c=this;return i.all(a.values.map(function(d,e){var f=a.modification(e,d-b),g=a.modification(e,d+b);return i.then(f.evaluate(),function(a){return i.then(g.evaluate(),function(d){var e=c.problem.compare(f,g);return e=0===e?e:e>0?1:-1,(a-d)*e/2/b})})}))},gradientSimultaneousPerturbation:function(a,b){throw new Error("GradientDescent.gradientSimultaneousPerturbation() is not implemented!")},"static __SERMAT__":{identifier:"GradientDescent",serializer:function(a){return[a.__params__("delta")]}}});p.HelloWorld=d(r,{title:"Hello world",description:"Simple problem where each element is a string, and the optimization goes towards the target string.",constructor:function(a){e(this,a).string("target",{coerce:!0,defaultValue:"Hello world!"}),this.__target__=f(this.target).map(function(a){return a.charCodeAt(0)}).toArray(),r.call(this,b.copy({objective:-(1/0),elementModel:j.repeat({n:95},this.target.length).toArray()},a))},mapping:function(a){return a.values.map(function(a){return String.fromCharCode(a+32)}).join("")},evaluation:function(a){return a.manhattanDistance(this.__target__,a.values)},sufficientElement:function(a){return this.mapping(a)===this.target},"static __SERMAT__":{identifier:"HelloWorld",serializer:function(a){return[a.__params__("target")]}}});var u=p.TestBed=d(r,{constructor:function(a){var c=isNaN(a.minimumValue)?-1e6:+a.minimumValue,d=isNaN(a.maximumValue)?1e6:+a.maximumValue,e=isNaN(a.length)?2:+a.length;r.call(this,b.copy({title:a.title,elementModel:j.repeat({n:1e4},e).toArray()},a)),this.evaluation=function(b){return a.evaluation(b.rangeMapping([c,d]))},a.hasOwnProperty("optimumValue")&&(this.sufficientElement=function(b){return Math.abs(b.evaluation-a.optimumValue)<b.resolution})}});p.testbeds={Ackley:function(a,b,c,d){return b=isNaN(b)?20:+b,c=isNaN(c)?.2:+c,d=isNaN(d)?2*Math.PI:+d,new u({title:"Ackley testbed",length:a,objectives:-(1/0),minimumValue:-32.768,maximumValue:32.768,optimumValue:0,evaluation:function(a){for(var e,f=0,g=0,h=a.length,i=0;i<h;++i)e=a[i],f+=e*e,g+=Math.cos(d*e);return-b*Math.exp(-c*Math.sqrt(f/h))-Math.exp(g/h)+b+Math.exp(1)}})},crossInTray:function(a){return a=isNaN(a)?-(1/0):+a,new u({title:"cross-in-tray testbed",length:2,objectives:a,minimumValue:-10,maximumValue:10,evaluation:function(a){var b=a[0],c=a[1];return-1e-4*Math.pow(Math.abs(Math.sin(b)*Math.sin(c)*Math.exp(Math.abs(100-Math.sqrt(b*b+c*c)/Math.PI)))+1,.1)}})},Griewank:function(a){return new u({title:"Griewank testbed",length:a,minimumValue:-600,maximumValue:600,optimumValue:0,evaluation:function(a){for(var b,c=0,d=1,e=a.length,f=0;f<e;++f)b=a[f],c+=b*b/4e3,d*=Math.cos(b/Math.sqrt(f+1));return c-d+1}})},Levy:function(a){return new u({title:"Levy testbed",length:a,objectives:-(1/0),minimumValue:-10,maximumValue:10,optimumValue:0,evaluation:function(a){for(var b,c=0,d=a.length,e=1+(a[0]-1)/4,f=1+(a[d-1]-1)/4,g=1;g<d-1;++g)b=1+(a[g]-1)/4,c+=Math.pow(b-1,2)*(1+10*Math.pow(Math.sin(Math.PI*b+1),2));return Math.pow(Math.sin(Math.PI*e),2)+c+Math.pow(f-1,2)*(1+Math.pow(Math.sin(2*Math.PI*f),2))}})},Michalewicz:function(a,b){return b=isNaN(b)?10:+b,new u({title:"Michalewicz testbed",length:a,objectives:-(1/0),minimumValue:0,maximumValue:Math.PI,evaluation:function(a){for(var c,d=0,e=a.length,f=0;f<e;++f)c=a[f],d+=Math.sin(c)*Math.pow(Math.sin((f+1)*c*c/Math.PI),2*b);return-d}})},perm0:function(a,b){return a=isNaN(a)?2:Math.min(1,0|a),b=isNaN(b)?0:+b,new u({title:"Perm(0,"+a+","+b+") testbed",length:a,objectives:-(1/0),minimumValue:-a,maximumValue:+a,optimumValue:0,evaluation:function(c){for(var d,e=0,f=0;f<a;++f){d=0;for(var g=0;g<a;++g)d+=(g+1+b)*(Math.pow(c[g],f+1)-Math.pow(1/(g+1),f+1));e+=d*d}return e}})},Rastrigin:function(a){return new u({title:"Rastrigin testbed",length:a,objectives:-(1/0),minimumValue:-5.12,maximumValue:5.12,optimumValue:0,evaluation:function(a){for(var b,c=0,d=a.length,e=0;e<d;++e)b=a[e],c+=b*b-10*Math.cos(2*Math.PI*b);return 10*d+c}})},Rosenbrock:function(a,b,c){return b=isNaN(b)?1:+b,c=isNaN(c)?100:+c,new u({title:"Rosenbrock testbed",length:a,objectives:-(1/0),optimumValue:0,evaluation:function(a){for(var d=0,e=1;e<a.length;++e)d+=c*Math.pow(a[e-1]*a[e-1]-a[e],2)+Math.pow(a[e-1]-b,2);return d}})},Schwefel:function(a){return new u({title:"Schwefel testbed",length:a,objectives:-(1/0),minimumValue:-500,maximumValue:500,optimumValue:0,evaluation:function(a){for(var b,c=0,d=a.length,e=0;e<d;++e)b=a[e],c+=b*Math.sin(Math.sqrt(Math.abs(b)));return 418.9829*d-c}})},sphere:function(a){return new u({title:"sphere testbed",length:a,objectives:-(1/0),optimumValue:0,evaluation:function(a){for(var b=0,c=0;c<a.length;++c)b+=a[c]*a[c];return b}})},sumOptimization:function(a,b){return a=isNaN(a)?2:Math.max(1,0|a),b=isNaN(b)?-(1/0):+b,new u({title:"sum optimization testbed",length:a,objectives:b,minimumValue:0,maximumValue:1,optimumValue:b===-(1/0)?0:b===+(1/0)?a:b,evaluation:function(a){for(var b=0,c=0,d=a.length;c<d;c++)b+=a[c];return b}})},ZDT1:function(a){return a=isNaN(a)?30:Math.max(1,0|a),new u({title:"Zitzler-Deb-Thiele function 1",length:a,objectives:[-(1/0),-(1/0)],minimumValue:0,maximumValue:1,evaluation:function(a){var b=a[0],c=f(a).tail().sum()/(a.length-1)*9,d=1-Math.sqrt(b/c);return[b,c*d]}})},ZDT2:function(a){return a=isNaN(a)?30:Math.max(1,0|a),new u({title:"Zitzler-Deb-Thiele function 2",length:a,objectives:[-(1/0),-(1/0)],minimumValue:0,maximumValue:1,evaluation:function(a){var b=a[0],c=f(a).tail().sum()/(a.length-1)*9,d=1-Math.pow(b/c,2);return[b,c*d]}})},ZDT3:function(a){return a=isNaN(a)?30:Math.max(1,0|a),new u({title:"Zitzler-Deb-Thiele function 3",length:a,objectives:[-(1/0),-(1/0)],minimumValue:0,maximumValue:1,evaluation:function(a){var b=a[0],c=f(a).tail().sum()/(a.length-1)*9,d=1-Math.sqrt(b/c)-b/c*Math.sin(10*Math.PI*b);return[b,c*d]}})}},p.NQueensPuzzle=d(r,{title:"N-queens puzzle",description:"Generalized version of the classic problem of placing 8 chess queens on an 8x8 chessboard so that no two queens attack each other.",constructor:function(a){e(this,a).integer("N",{coerce:!0,defaultValue:8}),r.call(this,b.copy({objective:-(1/0),elementModel:j.repeat({n:this.N},this.N-1).toArray()},a)),this.__rowRange__=j.range(this.N).toArray()},mapping:function(a){return a.setMapping(this.__rowRange__)},evaluation:function(a){var b=this.mapping(a),c=0;return b.forEach(function(a,d){for(var e=1;d+e<b.length;e++)b[e]!=a+e&&b[e]!=a-e||c++}),c},sufficientElement:function(a){return 0===a.evaluation},"static __SERMAT__":{identifier:"NQueensPuzzle",serializer:function(a){return[a.__params__("N")]}}}),p.KnapsackProblem=d(r,{title:"Knapsack problem",description:"Given a set of items with a cost and a worth, select a subset  maximizing the worth sum but not exceeding a cost limit.",items:{itemA:{cost:12,worth:4},itemB:{cost:2,worth:2},itemC:{cost:1,worth:2},itemD:{cost:1,worth:1},itemE:{cost:4,worth:10}},constructor:function(a){
e(this,a).number("limit",{coerce:!0,defaultValue:15}).integer("amount",{coerce:!0,defaultValue:1,minimum:1}).object("items",{ignore:!0});var c=this.items;this.__elementItems__=Object.keys(c),this.__elementItems__.sort(),r.call(this,b.copy({objective:+(1/0),elementModel:this.__elementItems__.map(function(a){return{n:+c[a].amount||1}})},a))},mapping:function(a){return f(this.__elementItems__).zip(Math.floor(a.values)).toObject()},evaluation:function(a){var b=this.mapping(a),c=this.items,d=0,e=0;return f(b).forEachApply(function(a,b){var f=c[a];d+=f.worth*b,e+=f.cost*b}),e>problem.limit?-d:d},"static __SERMAT__":{identifier:"KnapsackProblem",serializer:function(a){return[a.__params__("limit","amount","items")]}}});p.AssociationRuleLearning=d(r,{constructor:function(a){e(this,a).object("dataset",{defaultValue:[]}).array("keys"),r.call(this,b.copy({elementModel:j.repeat({n:3},this.keys.length).toArray()},a))},mapping:function(a){var b=this,c=[],d=[];return a.values.forEach(function(a,e){switch(a){case 1:c.push(b.keys[e]);break;case 2:d.push(b.keys[e])}}),{antecedent:c,consequent:d}},keysComply:function(a,b){var c=f(a);return!c.isEmpty()&&c.all(function(a){return!!b[a]})},antecedentComplies:function(a,b){return this.keysComply(a.antecedent,b)},consequentComplies:function(a,b){return this.keysComply(a.consequent,b)},measures:function(a){var b=this,c={},d=0,e=0,g=0,h=0,i=this.mapping(a);return f(this.dataset).forEach(function(a){b.antecedentComplies(i,a)?(++e,b.consequentComplies(i,a)&&(++g,++h)):b.consequentComplies(i,a)&&++g,++d}),c.antecedentCount=e,c.consequentCount=g,c.ruleCount=h,c.antecedentSupport=d>0?e/d:0,c.consequentSupport=d>0?g/d:0,c.ruleSupport=d>0?h/d:0,c.confidence=e>0?h/e:0,c.lift=c.consequentSupport>0?c.confidence/c.consequentSupport:0,c.conviction=c.consequentSupport>0&&c.confidence<1?(1-c.consequentSupport)/(1-c.confidence):0,c.leverage=c.ruleSupport-c.antecedentSupport*c.consequentSupport,c},evaluation:function(a){return a.__measures__||(a.__measures__=this.measures(a)),a.__measures__.confidence}});return b.Iterable.chain(n,o,p).forEachApply(function(a,b){"function"==typeof b&&b.__SERMAT__&&b.__SERMAT__.identifier&&(b.__SERMAT__.identifier=n.__package__+"."+b.__SERMAT__.identifier,n.__SERMAT__.include.push(b))}),n});
//# sourceMappingURL=inveniemus.min.js.map